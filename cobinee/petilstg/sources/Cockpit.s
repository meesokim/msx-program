; Cockpit.s : コクピット
;


; モジュール宣言
;
    .module Cockpit

; 参照ファイル
;
    .include    "bios.inc"
    .include    "vdp.inc"
    .include    "System.inc"
    .include    "App.inc"
    .include	"Game.inc"
    .include    "Player.inc"
    .include	"Cockpit.inc"


; CODE 領域
;
    .area   _CODE

; コクピットを初期化する
;
_CockpitInitialize::
    
    ; レジスタの保存
    
    ; パターンネームの初期化
    ld      hl, #cockpitPatternName
    ld      de, #(_gamePatternName + 0x0200)
    ld      bc, #0x0100
    ldir
    
    ; レジスタの復帰
    
    ; 終了
    ret

; コクピットを更新する
;
_CockpitUpdate::
    
    ; レジスタの保存
    
    ; レジスタの復帰
    
    ; 終了
    ret
    
; コクピットを描画する
;
_CockpitRender::
    
    ; レジスタの保存
    
    ; シールドの描画
    ld      hl, #(_gamePatternName + 0x02c1)
    ld      de, (_playerShield)
    ld      a, d
    or      e
    jr      z, 02$
    ld      a, d
    ld      b, #0x09
00$:
    cp      #0x08
    jr      c, 01$
    ld      a, #0x08
01$:
    ld      e, a
    add     a, #0x70
    ld      (hl), a
    inc     hl
    ld      a, d
    sub     e
    ld      d, a
    djnz    00$
    jr      09$
02$:
    ld      a, (_gameFrame)
    and     #0x10
    ld      c, a
    ld      b, #0x00
    ld      de, #cockpitEmergency
    ex      de, hl
    add     hl, bc
    ld      c, #0x09
    ldir
09$:
    
    ; エネルギーの描画
    ld      hl, #(_gamePatternName + 0x02d6)
    ld      a, (_playerEnergy + 0x01)
    ld      e, a
    cp      #0x10
    jr      nc, 10$
    ld      a, (_gameFrame)
    and     #0x10
    jr      z, 13$
10$:
    ld      a, e
    ld      b, #0x09
11$:
    cp      #0x08
    jr      c, 12$
    ld      a, #0x08
12$:
    ld      d, a
    add     a, #0x70
    ld      (hl), a
    inc     hl
    ld      a, e
    sub     d
    ld      e, a
    djnz    11$
    jr      19$
13$:
    ld      de, #cockpitEmergency
    ex      de, hl
    ld      bc, #0x0009
    ldir
19$:

    ; レジスタの復帰
    
    ; 終了
    ret

; 定数の定義
;

; パターンネーム
;
cockpitPatternName:

    .db     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x61, 0x60, 0x60, 0x60
    .db     0x60, 0x60, 0x60, 0x62, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
    .db     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x51, 0x51, 0x51, 0x52, 0x52, 0x53, 0x60, 0x60, 0x60, 0x60
    .db     0x60, 0x60, 0x60, 0x60, 0x54, 0x52, 0x52, 0x51, 0x51, 0x51, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
    .db     0x51, 0x51, 0x51, 0x52, 0x52, 0x52, 0x52, 0x52, 0x52, 0x52, 0x52, 0x53, 0x60, 0x60, 0x60, 0x68
    .db     0x69, 0x60, 0x60, 0x60, 0x54, 0x52, 0x52, 0x52, 0x52, 0x52, 0x52, 0x52, 0x52, 0x51, 0x51, 0x51
    .db     0x5c, 0x57, 0x57, 0x57, 0x57, 0x57, 0x57, 0x57, 0x57, 0x57, 0x5d, 0x55, 0x60, 0x60, 0x60, 0x6a
    .db     0x6b, 0x60, 0x60, 0x60, 0x56, 0x5c, 0x57, 0x57, 0x57, 0x57, 0x57, 0x57, 0x57, 0x57, 0x57, 0x5d
    .db     0x5a, 0x00, 0x00, 0x33, 0x28, 0x29, 0x25, 0x2c, 0x24, 0x00, 0x5b, 0x55, 0x60, 0x60, 0x60, 0x60
    .db     0x60, 0x60, 0x60, 0x60, 0x56, 0x5a, 0x00, 0x25, 0x2e, 0x25, 0x32, 0x27, 0x39, 0x00, 0x00, 0x5b
    .db     0x5c, 0x59, 0x59, 0x59, 0x59, 0x59, 0x59, 0x59, 0x59, 0x59, 0x5d, 0x55, 0x60, 0x60, 0x60, 0x60
    .db     0x60, 0x60, 0x60, 0x60, 0x56, 0x5c, 0x59, 0x59, 0x59, 0x59, 0x59, 0x59, 0x59, 0x59, 0x59, 0x5d
    .db     0x5a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x5b, 0x55, 0x60, 0x60, 0x60, 0x60
    .db     0x60, 0x60, 0x60, 0x60, 0x56, 0x5a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x5b
    .db     0x50, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x50, 0x55, 0x63, 0x60, 0x60, 0x60
    .db     0x60, 0x60, 0x60, 0x64, 0x56, 0x50, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x50

; 警告文字
;
cockpitEmergency:
    
    .db     0x80, 0x81, 0x80, 0x82, 0x83, 0x80, 0x84, 0x85, 0x86, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
    .db     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
;   .db     0x88, 0x89, 0x88, 0x8a, 0x8b, 0x88, 0x8c, 0x8d, 0x8e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00


; DATA 領域
;
    .area   _DATA

; 変数の定義
;

