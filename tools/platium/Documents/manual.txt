
-------------------------------------------------------------------------------
 簡易マニュアル
-------------------------------------------------------------------------------


■簡単な使用方法
1.ファイルメニューの「新規作成」を選択して任意のサイズの新規マッププロジェクトを作成します。

2.パーツウィンドウの読み込みボタンを押すかパーツウィンドウにパーツ画像をドラッグ＆ドロップして、
　初期レイヤー(レイヤー0)で扱いたいパーツ画像を読み込みます。
　（パーツウィンドウはレイヤーウィンドウで現在選択されているレイヤーに対して新たにパーツ画像を読み込んだり、現在読み込まれているパーツ画像を表示したり、パーツを選択する時に使用します）

3.複数のレイヤーを扱いたい場合はプロジェクトの設定で透明パーツを有効にして透明パーツを指定します。
　（透明パーツを指定しないと下のレイヤーが見えなくなってしまいます。透明パーツの概要はfaq.txtの”レイヤーを多く重ねると動作が重いのですが？”を参照してください）

4.パーツウィンドウでパーツを選択してから任意のツールでマップを構築していきます。
　新規レイヤーを追加した段階ではそのレイヤーにパーツ画像は割り当てられていないので、
　上記の方法でパーツ画像を読み込んでください。
　既にパーツ画像を幾つか読み込んでいる場合はレイヤーメニューのレイヤー設定からパーツ画像を指定できます。
　パーツ画像を閉じた場合はそのパーツ画像を参照している全てのレイヤーから参照が解除されます。

5.マップが完成したら任意のフォーマットでマップデータの書き出しを行います。


■メニューの説明
【ファイル】
・新規作成
	新規にマップファイルを作成します。
	作成出来るマップの上限は縦10000、横10000パーツまでです。

・開く
	既存のファイルを開きます。

・再読み込み
	現在開いているファイルの変更を破棄して読み込みなおします。

・上書き保存
	現在編集中のファイルを新規/上書き保存します。

・名前を付けて保存
	編集中のファイルを別名を付けて保存します。

・読み込み
	読み込み対応のプラグインを使用してファイルからデータを読み込みます。
	詳しい説明は同梱の「plugin.txt」をお読みください。

・書き出し
	書き出し対応のプラグインを使用してデータをファイルに書き出します。
	詳しい説明は同梱の「plugin.txt」をお読みください。

・終了
	マップエディタを終了します。


【編集】
・取り消し
	直前のマップ編集操作を取り消します。
	Undo, Redo可能な操作：
	ペン、タイリングペン、切り取り、貼り付け、塗りつぶし、置き換え

・やり直し
	取り消す前の状態に戻します。制限は上に同じ。

・切り取り
	選択範囲内のデータをコピーした後、透明パーツが設定されていれば透明パーツで塗り潰し、
	設定されてなければ現在選択されているパーツで塗り潰されます。
	(Deleteキーを押した場合はコピーを行わず選択範囲内のデータが削除されます)

・コピー
	選択範囲内のデータをコピーします。

・貼り付け
	コピーしたデータを現在の選択範囲内へ貼り付けます。
	（多重起動した別プロセスのPlatinumにも貼り付けられます）

・全てを選択
	マップ全体を選択範囲とします。

・選択範囲の解除
	現在の選択範囲を解除します。
	選択範囲の移動/複製を行っている状態で選択範囲の解除を行うと移動/複製が確定されます。

・置き換え
	置き換え対象のパーツを別のパーツに置き換えます。
	カレントレイヤーの全データに対して処理が適応されます。

・塗りつぶし
	選択範囲内を選択パーツ/定義パターンか透明パーツで塗りつぶします。
	Ctrl+Deleteキーを押すとダイアログは出ずに選択パーツ/定義パターンで塗り潰されます。

・取り消しバッファのフラッシュ
	Undo Redoはメモリの許す限り行えるので作業を進めていると履歴バッファが次第に膨れ上がっていきます。
	古い履歴はファイルに保存するなどの頭のいい事は行ってないのでメモリが圧迫されてきたら、
	フラッシュしてメモリを開放してください。ですがそれほど気にする必要はないと思います。

・プロジェクト設定
	《一般設定タブ》
		プロジェクトファイルの一般設定。
		・ファイル名のみ
			パーツ画像のファイル名だけをプロジェクトファイル内に保存します。
			パーツ画像はプロジェクトファイルと同一ディレクトリ入っている必要があります。
		・プロジェクトファイルからの相対パス
			パーツ画像のパスをプロジェクトファイルから見た相対パスで
			プロジェクトファイル内に保存します。
		・透明パーツを有効にする
			チェックを入れると透明パーツが有効化されます。
			パーツ番号を入力すると該当するパーツ番号は透明パーツと見なされ表示されません。
	《グリッドタブ》
		各グリッド色の設定。
	《コメントタブ》
		プロジェクトにコメントを書くことができます。

【ツール】
・ペンツール
	現在選択されているパーツ、又は定義パターンをマップに配置します。

・タイリングペンツール
	マウスドラッグで範囲を指定した後、ボタンを離すとその範囲内へ収まるように
	パーツ/パターンを敷き詰めます。
	垂直なラインやボックス/フレームを作成する場合に便利です。

・塗りつぶしツール
	クリックした位置のパーツと同じ隣接するパーツ全てに対して
	パーツウィンドウの選択パーツで塗りつぶします。
	複数パーツ/パターンが選択されている場合には常に左上のパーツが使用されます。

・矩形選択ツール
	矩形の選択範囲を指定出来ます。
	作成した選択範囲は切り取り、コピー、貼り付けできます。
	選択範囲をドラッグ＆ドロップすると選択範囲内のデータを移動でき、
	Ctrlキーを押しながら選択範囲をドラッグ＆ドロップすると選択範囲内のデータを複製出来ます。
	同時にShiftキーを併用すると全ての可視レイヤーが対象になります。
	選択範囲を解除/他のツールに切り替えると移動/複製が確定されます。

・パターン定義ツール
	エディタ面のクリックした位置のパーツをカレントパーツとして選択します。
	ドラッグ&ドロップ操作でパターンを定義出来ます。
	定義されたパターンはペン/タイリングペン/塗り潰しで置けるようになります。
	新たにパーツウィンドウでパーツを選択するとパターン定義は自動的に解除されます。
	マウス右ボタン操作でも一時的にパターン定義ツールに切り替わります。

・ハンドツール
	マウスで画面をドラッグすると画面をスクロールする事が出来ます。
	他のツールを使用している時に一時的にハンドツールを使用する場合はスペースキーを押し続けます。

・リサイズ
	マップのサイズを変更します。
	取り消しは出来ないので注意してください。

・スクロール
	全レイヤー/カレントレイヤーのマップデータを移動させます。
	移動により発生した未定義領域はラップアラウンド（巻き戻し）します。


【レイヤー】
・新規レイヤー
	空のレイヤーを作成します。
	レイヤーのサイズ（幅、高さ）はプロジェクト全体で固定です。
	透明パーツが有効になっている場合はレイヤー全体が透明パーツで塗り潰されます。

・レイヤーを複製
	現在選択されているレイヤーを複製します。
	複製元のレイヤーに関連付けられているパーツ画像も一緒に関連付けられます。

・レイヤーを削除
	現在選択されているレイヤーを削除します。
	※取り消しは出来ません。

・上のレイヤーを選択
	カレントレイヤーの１つ上のレイヤーを選択します。

・下のレイヤーを選択
	カレントレイヤーの１つ下のレイヤーを選択します。

・レイヤー設定
	レイヤーの設定を変更するダイアログを出します。
	名前の変更と使用しているパーツ画像の変更が行えます。
	※新たにパーツ画像を読み込みたい場合はパーツウィンドウの読み込みボタンを使います。

【ビュー】
・エディタ面の拡大
	エディタウィンドウの表示サイズを拡大します。

・エディタ面の縮小
	エディタウィンドウの表示サイズを縮小します。

・エディタ面を元のサイズに戻す
	表示を元のサイズへ戻します。

・パーツ面の拡大
	パーツウィンドウの表示サイズを拡大します。

・パーツ面の縮小
	パーツウィンドウの表示サイズを縮小します。

・パーツ面を元のサイズに戻す
	パーツウィンドウの表示を元のサイズへ戻します。

・グリッドの表示
	パーツサイズのグリッドを表示します。

・カーソルグリッドの表示
	選択されているパーツ/パターンのサイズでカーソル位置にグリッドを表示します。

・カレントレイヤーマーカーの表示
	カレントレイヤーの可視パーツに三角記号（マーカー）を付けて表示します。
	これを表示しておく事により間違って意図しない別のレイヤーを編集してしまう事が防げます。
	（※この機能は透明パーツを有効にしないと全てのパーツにマーカーが付きますので
	注意してください。）

・レイヤーの濃淡表示
	カレントレイヤー以外のレイヤーを半透明で表示します。
	カレントレイヤーマーカと趣旨は同じですが、透明パーツの設定に関係なく機能します。

・パーツ番号の表示
	カレントレイヤーのパーツの上にデータ番号を表示します。
	パーツサイズが小さいと数字がマスからはみ出る場合がありますが仕様です。

・透過処理を行う
	透過色による透過処理を行います。
	パーツに透過色が含まれている場合その色は描画されず下のレイヤーが透けて見えます。

・透過色の指定...
	透過させる色を選択します。
	この透過色は全てのレイヤーで共通です。
	一般に透過色としてよく用いられている色が色選択ダイアログに登録されています。
	パーツウィンドウで透過色として設定したい色付近をCtrl+クリックする事でも設定出来ます。


【ウィンドウ】
・パーツウィンドウ
	パーツウィンドウの表示/非表示を切り替えます。

・レイヤーウィンドウ
	レイヤーウィンドウの表示/非表示を切り替えます。

・オーバービューウィンドウ
	オーバービューウィンドウの表示/非表示を切り替えます。


【ヘルプ】
・このアプリケーションについて
	アプリケーションの情報を表示。


■機能一覧

・置き換え
	マップデータを置換します。

・塗り潰し
	マップ全体を指定パーツ/パターンで塗り潰します。

・リサイズ
	いつでも好きなサイズにマップのサイズを変更できます。

・スクロール
	マップデータの位置関係を保ったまま指定量移動できます。

・パターン定義
	マップデータの一部をパターンとして定義してペンでの編集や塗り潰しが可能。

・無制限 Undo, Redo
	マップデータへ変更を加える操作に対して「取り消し」「やり直し」が出来ます。
	Undo, Redo可能な操作：
	ペン、タイリングペン、切り取り/コピー/貼り付け
	塗りつぶし、置き換え、移動/複製、スクロール

・選択範囲の指定によるマップデータの切り貼り
	切り取り、コピー、貼り付けによるマップデータの切り貼りが行えます。

・選択領域内のデータを移動/複製（Shiftキーを押しながらだと全可視レイヤーが対象）

・レイヤー
	上下の位置関係を持つマップを作成したり、レイヤーの１つをイベント用の
	フラグマップとして利用したり、当たり判定情報を格納するレイヤの利用など用途は様々です。
	各レイヤー毎にパーツ画像を持てるので１パーツ画像では表現力が足りないと
	思うときはレイヤーを複数枚重ねて１つのマップを構成させる事も出来ます。
	最大255レイヤー作成可能。

・オーバービューウィンドウによるマップの縮小表示と画面移動

・透過処理
	ピクセル単位のカラーキーイング。
	設定した透過色は表示されず下のレイヤーが透過して見えます。

・書き出しフォーマット
	シンプルなデータ構造のFMFファイルの他に、CSVファイル、ビットマップファイルでの書き出しが可能。
	読み込みサンプルとしてC++,Delphiのソースコードを添付しておきます。

・入出力プラグイン
	読み込み/書き出し用のプラグインをサポート。
	独自のファイル形式を後から自由に追加できます。

・透明パーツ
	複数のレイヤーを扱う時に、上層レイヤーのパーツが存在しない部分に敷かれるパーツです。
	任意のパーツ番号を1つ指定することができ、
	また、透明パーツを使用不可にすることもできます。
	設定の変更はプロジェクト設定から行います。
	パーツウィンドウの任意のパーツをダブルクリックする事で番号を指定する事もできます。


■Tips
・全般
1.パーツウィンドウにパーツ画像をDrag&Dropするとその画像を読み込んだ後、
  カレントレイヤーに関連付けます。
2.エディタウィンドウに読み込み可能なファイルをDrag&Dropするとそのファイルを開きます。
3.外部でパーツ画像が編集されると自動的に再読み込みを行います。
4.パーツウィンドウで選択できるパーツとパターン定義ツールで作成できるパターンは
　排他関係にあり、パーツを選択するとパターンが解除され、パターンが選択されると
　パーツの選択が解除されます。
　ペンやタイリングペン、塗り潰しなどはこのどちらかのパーツ/パターンが使用されます。
5.パーツウィンドウでパーツをダブルクリックをするとそのパーツが透明パーツに設定されます。
6.選択範囲をマウスでDrag&Dropするとカレントレイヤーの選択範囲内のデータを移動でき、
　Ctrlキーを押しながらDrag&Dropするとカレントレイヤーの選択範囲内のデータを複製できます。
7.上記の選択範囲内データの移動/複製はカレントレイヤーのみに適応されますが、
　Shiftキーを押しながら移動/複製すると全可視レイヤーが対象となります。
8.レイヤーウィンドウで右クリックすると複製/合成などが行えるポップアップメニューが出ます。

・マウス操作について
1.左ボタンはペン、タイリングペン、選択範囲の作成などのツールに割り当てられています。
2.右ボタンはボタンを押している間だけ一時的にパターン定義ツールに切り替ります。
3.マウスホイールで画面を上下にスクロールする事ができます。Ctrlキーを押しながらホイール
  を回すと左右にスクロールします。
4.パーツウィンドウでCtrlキーを押しながらクリックするとクリックしたカーソル位置の色が
　透過処理の透過色として設定されます。

・キー操作について
1.よく使うメニュー操作にはキーボードショートカットが割り当てられています。
2.各種ツールにはFキーが割り当てられています（一部のツールはA,Z,X,C,Vにも割り当てあり）。
3.矢印キーで画面をスクロールする事が出来ます。
4.スペースキーを押している間はマウスで自由に画面をスクロール出来ます。
5.Escキーを押すごとにパーツ/レイヤー/オーバービューウィンドウの一時的な表示＆非表示が行えます。
6.Deleteキーを押すと'透明パーツ'で選択範囲内を塗り潰し、
  Ctrl+Deleteキーを押すと'選択パターン/定義パターン'で選択範囲内を塗り潰します。
7.d, f, g, rキーで現在選択されているパーツから相対的にパーツを選択する事ができます。
8.表示倍率をテンキーの0で等倍、1で1/2倍、2で1/4倍、3で1/8倍に切り替える事が出来ます。
9.レイヤーを初期化する場合はCtrl+Aキー -> Deleteキー -> Ctrl+Dを行います。

・追加のアプリケーション設定
　Platinum.iniのGeneralセクションに以下のキーを追加する事で追加の設定が有効になります。
　※カッコ内は指定できる数値の説明
　zoomratio=n (n=16..128)	ズーム係数（数値が大きい程、変化が大きく現れます）
　numbercolortype=n (n=0..5)	'パーツ番号の表示'で使用される番号の色
				(0=黒, 1=白, 2=グレー, 3=任意, 4=GridColor, 5=CursorGridColor)
　numbercolor=n (n=0..16777215)	パーツ番号の色(numbercolortype=3の場合に有効)
　boxnumber=n (n=0|1)		パーツ番号の文字をボックスの中に描画します
　numberbkcolor=n (n=0..16777215) boxnumber=1の時のボックスの色
　gridmin=n (n=1..)		グリッド表示の下限リミット
　numbermin=n (n=1..)		パーツ番号表示の下限リミット
　forceinvnum=n (n=0|1)		1を指定すると'パーツ番号の表示'にチェックが入っている状態で
				透明パーツ以外の可視パーツのみパーツ番号が表示されます
　syncmaingrid=n (n=0|1)	1を指定するとパーツウィンドウのグリッド表示状態を
				メインウィンドウのグリッド表示状態と同期します
　autoactive=n (n=0|1)		メインウィンドウにマウスカーソルが入ると
				自動的にメインウィンドウにフォーカスが移ります
　usetranslucentselect=n (n=0|1) 1を指定すると選択範囲の表示が半透明処理されます
　pwinalpha=n (n=0..255)	パーツウィンドウの透明度を指定します(255で不透明)
　lwinalpha=n (n=0..255)	レイヤーウィンドウの透明度を指定します(255で不透明)
　owinalpha=n (n=0..255)	オーバービューウィンドウの透明度を指定します(255で不透明)
　				(pwinalpha, lwinalpha, owinalphaは
				windows2000以上のシステムで有効になります)
  wheelaction=n (n=0|1)		n=0を指定すると従来通りのマウスホイールでの画面スクロール、
				n=1を指定するとマウスホイールでのレイヤー選択が可能になります

■FMFファイルの説明
FMFファイルはヘッダと１つ以上のレイヤーデータからなるバイナリファイルで、
シンプルなファイル構造になっています。
先頭にヘッダ領域(20Byte)が記録されておりその後にレイヤーデータブロックがFMFヘッダの
layerCount数出力されています。

[ヘッダ領域][レイヤー0領域][レイヤー1領域][レイヤーN領域]...
ヘッダ領域のサイズは20byte固定.
各レイヤー領域のサイズは mapWidth * mapHeight * (bitCount / 8) byte.

・データサイズの表記について
[U1] unsigned char (1byte)
[U4] unsigned integer (4byte)
バイトオーダーは最下位バイトから記録されるリトルエンディアンです。

【FMFファイルヘッダ (20 byte)】
+0	identifier	[U4]	// ファイル識別子 'FMF_' (0x5F464D46)
+4	size		[U4]	// ヘッダを除いたデータサイズ
+8	mapWidth	[U4]	// マップの横幅
+12	mapHeight	[U4]	// マップの縦幅
+16	chipHeight	[U1]	// パーツの横幅
+17	chipHeight	[U1]	// パーツの縦幅
+18	layerCount	[U1]	// レイヤー数
+19	bitCount	[U1]	// レイヤーデータのビットカウント(8/16)

【レイヤーデータ】
FMFヘッダの直後からマップパーツの値が mapWidth * mapHeight 個、ベタに並んでいます。

bitCountが8の場合、1パーツ8ビット(1byte)
bitCountが16の場合、1パーツが16ビット(2byte)

１レイヤーのデータサイズは以下のようになる。
layerSize = mapWidth * mapHeight * (bitCount / 8);
また、
fileSize = headerSize(20bytes) + layerSize * layerCount;
となる。

※詳しくは添付のソースコードを参照してください。
